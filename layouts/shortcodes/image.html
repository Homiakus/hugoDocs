{{/* Enhanced Image Shortcode */}}
{{/* Usage: {{< image src="/path/to/image.jpg" alt="Description" caption="Optional caption" >}} */}}

<figure class="image-container" style="margin: 1.5rem 0; text-align: center;">
    <img 
        src="{{ .Get "src" }}" 
        alt="{{ .Get "alt" | default "Image" }}"
        style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
        loading="lazy"
        onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
    />
    <div class="image-error" style="display: none; padding: 2rem; background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; color: #666;">
        <div style="margin-bottom: 0.5rem;">⚠️ Image not found</div>
        <div style="font-size: 0.9rem;">{{ .Get "src" }}</div>
    </div>
    {{ if .Get "caption" }}
        <figcaption style="margin-top: 0.5rem; font-size: 0.9rem; color: #666; font-style: italic;">
            {{ .Get "caption" }}
        </figcaption>
    {{ end }}
</figure>

<style>
.image-container img:hover {
    transform: scale(1.02);
    transition: transform 0.2s ease-in-out;
}

.image-container img {
    cursor: pointer;
}

/* Lightbox functionality */
.image-lightbox {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.9);
    backdrop-filter: blur(5px);
}

.image-lightbox img {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
}

.image-lightbox .close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
}

.image-lightbox .close:hover {
    color: #bbb;
}

.image-lightbox .caption {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    color: #f1f1f1;
    text-align: center;
    max-width: 80%;
}
</style>

<script>
(function() {
    // Add click handler for lightbox
    const images = document.querySelectorAll('.image-container img');
    
    images.forEach(function(img) {
        img.addEventListener('click', function() {
            openLightbox(this.src, this.alt);
        });
    });
    
    function openLightbox(src, alt) {
        const lightbox = document.createElement('div');
        lightbox.className = 'image-lightbox';
        lightbox.innerHTML = `
            <span class="close">&times;</span>
            <img src="${src}" alt="${alt}">
            <div class="caption">${alt}</div>
        `;
        
        document.body.appendChild(lightbox);
        lightbox.style.display = 'block';
        
        // Close on click
        lightbox.addEventListener('click', function(e) {
            if (e.target === lightbox || e.target.className === 'close') {
                document.body.removeChild(lightbox);
            }
        });
        
        // Close on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.body.contains(lightbox)) {
                    document.body.removeChild(lightbox);
                }
            }
        });
    }
})();
</script>